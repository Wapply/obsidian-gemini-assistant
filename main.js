/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => CardBoardPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian2 = require("obsidian");

// settings.ts
var import_obsidian = require("obsidian");
var DEFAULT_SETTINGS = {
  openNoteInNewTab: false,
  cardWidth: 200,
  // Default card width
  cardHeight: 200
  // Default card height
};
var CardBoardSettingTab = class extends import_obsidian.PluginSettingTab {
  constructor(app, plugin) {
    super(app, plugin);
    this.plugin = plugin;
  }
  display() {
    const { containerEl } = this;
    containerEl.empty();
    containerEl.createEl("h2", { text: "CardBoard Plugin Settings" });
    new import_obsidian.Setting(containerEl).setName("Open Note in New Tab").setDesc("Open notes in a new tab when clicked").addToggle(
      (toggle) => toggle.setValue(this.plugin.settings.openNoteInNewTab).onChange(async (value) => {
        this.plugin.settings.openNoteInNewTab = value;
        await this.plugin.saveSettings();
      })
    );
  }
};

// main.ts
var CardBoardPlugin = class extends import_obsidian2.Plugin {
  async onload() {
    console.log("Loading CardBoard Plugin");
    await this.loadSettings();
    this.addSettingTab(new CardBoardSettingTab(this.app, this));
    this.addRibbonIcon("blocks", "CardBoard", () => this.openCardBoard());
    this.addCommand({
      id: "open-card-board",
      name: "Open Card Board",
      callback: () => this.openCardBoard()
    });
    this.registerView(
      "card-board-view",
      (leaf) => {
        this.view = new CardBoardView(leaf, this.app.vault, this);
        return this.view;
      }
    );
    this.app.workspace.onLayoutReady(() => this.activateView());
  }
  async openCardBoard() {
    this.activateView();
  }
  activateView() {
    this.app.workspace.detachLeavesOfType("card-board-view");
    const rightLeaf = this.app.workspace.getRightLeaf(false);
    if (rightLeaf) {
      rightLeaf.setViewState({ type: "card-board-view" });
    }
  }
  onunload() {
    this.app.workspace.detachLeavesOfType("card-board-view");
    console.log("Unloading CardBoard Plugin");
  }
  async loadSettings() {
    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());
  }
  async saveSettings() {
    await this.saveData(this.settings);
  }
};
var CardBoardView = class extends import_obsidian2.ItemView {
  // Add the plugin property
  constructor(leaf, vault, plugin) {
    super(leaf);
    this.vault = vault;
    this.folderStack = [this.vault.getRoot()];
    this.plugin = plugin;
  }
  getViewType() {
    return "card-board-view";
  }
  getDisplayText() {
    return "Card Board";
  }
  async onOpen() {
    await this.renderView();
  }
  async renderView() {
    const container = this.containerEl.children[1];
    container.empty();
    container.classList.add("board-container");
    await this.createFolderView(this.folderStack[this.folderStack.length - 1], container);
  }
  async createFolderView(folder, parent) {
    const folderContainer = parent.createDiv({ cls: "folder-container" });
    const folderHeader = folderContainer.createDiv({ cls: "folder-header" });
    if (this.folderStack.length > 1) {
      const backButton = folderHeader.createEl("button", { cls: "back-button", text: "\u2190" });
      backButton.addEventListener("click", () => {
        this.folderStack.pop();
        this.renderView();
      });
    }
    folderHeader.createSpan({ text: folder.name });
    const notesContainer = folderContainer.createDiv({ cls: "notes-container" });
    const folders = folder.children.filter((child) => child instanceof import_obsidian2.TFolder);
    const notes = folder.children.filter((child) => child instanceof import_obsidian2.TFile && child.extension === "md");
    for (const folder2 of folders) {
      notesContainer.appendChild(this.createFolderCard(folder2));
    }
    for (const note of notes) {
      notesContainer.appendChild(await this.createCard(note));
    }
  }
  createFolderCard(folder) {
    const card = createDiv({ cls: ["card", "folder-card"] });
    const titleContainer = card.createDiv({ cls: "folder-title" });
    titleContainer.textContent = folder.name;
    card.addEventListener("click", () => {
      this.folderStack.push(folder);
      this.renderView();
    });
    return card;
  }
  async createCard(file) {
    const card = createDiv({
      cls: "card",
      attr: {
        style: `width: ${this.plugin.settings.cardWidth}px; height: ${this.plugin.settings.cardHeight}px;`
      }
    });
    const titleContainer = card.createDiv({ cls: "card-title" });
    titleContainer.textContent = file.basename;
    const thumb = await this.getThumbnail(file);
    if (thumb) {
      card.appendChild(thumb);
    } else {
      card.textContent = file.basename;
    }
    card.addEventListener("click", () => {
      const filePath = file.path;
      if (this.plugin.settings.openNoteInNewTab) {
        this.app.workspace.openLinkText(filePath, "", true, { active: true });
      } else {
        this.app.workspace.openLinkText(filePath, "", false);
      }
    });
    const configButton = card.createEl("button", { cls: "config-button", text: "\u2699" });
    configButton.addEventListener("click", (e) => {
      e.stopPropagation();
      new NoteConfigModal(this.app, file, this).open();
    });
    return card;
  }
  async getThumbnail(file) {
    const content = await this.vault.cachedRead(file);
    const imageRegex = /!\[\[(.*?)\]\]|!\[(.*?)\]\(([^)]*)\)/g;
    let match;
    while ((match = imageRegex.exec(content)) !== null) {
      let filePath = match[1] || match[3];
      if (filePath.startsWith("file:///")) {
        filePath = decodeURI(filePath).replace(/^file:\/{2,3}/, "").replace(/\\/g, "/");
      }
      if (/\.(jpg|jpeg|png|gif|bmp|mp4|webm)$/i.test(filePath)) {
        const fileLink = this.app.metadataCache.getFirstLinkpathDest(filePath, file.path);
        if (fileLink) {
          const resourcePath = this.vault.adapter.getResourcePath(fileLink.path);
          if (/\.(jpg|jpeg|png|gif|bmp)$/i.test(filePath)) {
            const img = createEl("img");
            img.src = resourcePath;
            return img;
          } else {
            const video = createEl("video");
            video.src = resourcePath;
            video.controls = true;
            video.muted = true;
            video.style.width = "100%";
            video.style.height = "auto";
            return video;
          }
        }
      }
    }
    return null;
  }
  async onClose() {
  }
};
var NoteConfigModal = class extends import_obsidian2.Modal {
  constructor(app, file, cardBoardView) {
    super(app);
    this.file = file;
    this.imagePaths = [];
    this.currentImageIndex = 0;
    this.cardBoardView = cardBoardView;
  }
  async onOpen() {
    await this.loadImages();
    this.displayImage();
  }
  async loadImages() {
    const content = await this.app.vault.cachedRead(this.file);
    const imageRegex = /!\[\[(.*?)\]\]|!\[(.*?)\]\(([^)]*)\)/g;
    let match;
    while ((match = imageRegex.exec(content)) !== null) {
      let imagePath = match[1] || match[3];
      if (imagePath.startsWith("file:///")) {
        imagePath = decodeURI(imagePath).replace(/^file:\/{2,3}/, "").replace(/\\/g, "/");
      }
      if (imagePath && /\.(jpg|jpeg|png|gif|bmp)$/.test(imagePath)) {
        this.imagePaths.push(imagePath);
      }
    }
  }
  displayImage() {
    this.contentEl.empty();
    if (this.imagePaths.length > 0) {
      const imagePath = this.imagePaths[this.currentImageIndex];
      const fileLink = this.app.metadataCache.getFirstLinkpathDest(imagePath, this.file.path);
      if (fileLink) {
        const imgSrc = this.app.vault.adapter.getResourcePath(fileLink.path);
        const imgContainer = this.contentEl.createDiv({ cls: "image-container" });
        const img = imgContainer.createEl("img", { attr: { src: imgSrc } });
        const buttonsContainer = this.contentEl.createDiv({ cls: "buttons-container" });
        const prevButton = buttonsContainer.createEl("button", { cls: "nav-button prev-button", text: "\u2039" });
        prevButton.addEventListener("click", () => {
          this.currentImageIndex = (this.currentImageIndex - 1 + this.imagePaths.length) % this.imagePaths.length;
          this.displayImage();
        });
        const nextButton = buttonsContainer.createEl("button", { cls: "nav-button next-button", text: "\u203A" });
        nextButton.addEventListener("click", () => {
          this.currentImageIndex = (this.currentImageIndex + 1) % this.imagePaths.length;
          this.displayImage();
        });
        const setThumbnailButton = this.contentEl.createEl("button", {
          cls: "set-button",
          text: "Set as Thumbnail"
        });
        setThumbnailButton.addEventListener("click", async () => {
          await this.setThumbnail(this.imagePaths[this.currentImageIndex]);
          this.close();
        });
      }
    } else {
      this.contentEl.setText("No images found in this note.");
    }
  }
  async setThumbnail(imagePath) {
    let newContent = await this.app.vault.read(this.file);
    const imageRegex = new RegExp(`!\\[\\[${imagePath}\\]\\]|!\\[.*?\\]\\(${imagePath}\\)`, "g");
    newContent = newContent.replace(imageRegex, "");
    if (imagePath.startsWith("file:///")) {
      newContent = `![ ](${imagePath})

${newContent}`;
    } else {
      newContent = `![[${imagePath}]]

${newContent}`;
    }
    await this.app.vault.modify(this.file, newContent);
    this.cardBoardView.renderView();
    this.close();
  }
  onClose() {
    this.contentEl.empty();
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyIsICJzZXR0aW5ncy50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgQXBwLCBJdGVtVmlldywgTW9kYWwsIFBsdWdpbiwgVEZpbGUsIFZhdWx0LCBXb3Jrc3BhY2VMZWFmLCBURm9sZGVyIH0gZnJvbSAnb2JzaWRpYW4nO1xyXG5pbXBvcnQgeyBDYXJkQm9hcmRTZXR0aW5nVGFiLCBDYXJkQm9hcmRQbHVnaW5TZXR0aW5ncywgREVGQVVMVF9TRVRUSU5HUyB9IGZyb20gXCIuL3NldHRpbmdzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkQm9hcmRQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xyXG4gIHNldHRpbmdzOiBDYXJkQm9hcmRQbHVnaW5TZXR0aW5ncztcclxuICB2aWV3OiBDYXJkQm9hcmRWaWV3O1xyXG5cclxuICBhc3luYyBvbmxvYWQoKSB7XHJcbiAgICBjb25zb2xlLmxvZygnTG9hZGluZyBDYXJkQm9hcmQgUGx1Z2luJyk7XHJcblxyXG4gICAgYXdhaXQgdGhpcy5sb2FkU2V0dGluZ3MoKTtcclxuICAgIHRoaXMuYWRkU2V0dGluZ1RhYihuZXcgQ2FyZEJvYXJkU2V0dGluZ1RhYih0aGlzLmFwcCwgdGhpcykpO1xyXG5cclxuICAgIHRoaXMuYWRkUmliYm9uSWNvbignYmxvY2tzJywgJ0NhcmRCb2FyZCcsICgpID0+IHRoaXMub3BlbkNhcmRCb2FyZCgpKTtcclxuXHJcbiAgICB0aGlzLmFkZENvbW1hbmQoe1xyXG4gICAgICBpZDogJ29wZW4tY2FyZC1ib2FyZCcsXHJcbiAgICAgIG5hbWU6ICdPcGVuIENhcmQgQm9hcmQnLFxyXG4gICAgICBjYWxsYmFjazogKCkgPT4gdGhpcy5vcGVuQ2FyZEJvYXJkKCksXHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLnJlZ2lzdGVyVmlldyhcclxuICAgICAgJ2NhcmQtYm9hcmQtdmlldycsXHJcbiAgICAgIChsZWFmKSA9PiB7XHJcbiAgICAgICAgdGhpcy52aWV3ID0gbmV3IENhcmRCb2FyZFZpZXcobGVhZiwgdGhpcy5hcHAudmF1bHQsIHRoaXMpOyAvLyBQYXNzIFwidGhpc1wiICh0aGUgcGx1Z2luIGluc3RhbmNlKVxyXG4gICAgICAgIHJldHVybiB0aGlzLnZpZXc7XHJcbiAgICAgIH1cclxuICAgICk7XHJcblxyXG4gICAgdGhpcy5hcHAud29ya3NwYWNlLm9uTGF5b3V0UmVhZHkoKCkgPT4gdGhpcy5hY3RpdmF0ZVZpZXcoKSk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBvcGVuQ2FyZEJvYXJkKCkge1xyXG4gICAgdGhpcy5hY3RpdmF0ZVZpZXcoKTtcclxuICB9XHJcblxyXG4gIGFjdGl2YXRlVmlldygpIHtcclxuICAgIHRoaXMuYXBwLndvcmtzcGFjZS5kZXRhY2hMZWF2ZXNPZlR5cGUoJ2NhcmQtYm9hcmQtdmlldycpO1xyXG4gICAgY29uc3QgcmlnaHRMZWFmID0gdGhpcy5hcHAud29ya3NwYWNlLmdldFJpZ2h0TGVhZihmYWxzZSk7XHJcbiAgICBpZiAocmlnaHRMZWFmKSB7XHJcbiAgICAgIHJpZ2h0TGVhZi5zZXRWaWV3U3RhdGUoeyB0eXBlOiAnY2FyZC1ib2FyZC12aWV3JyB9KTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG9udW5sb2FkKCkge1xyXG4gICAgdGhpcy5hcHAud29ya3NwYWNlLmRldGFjaExlYXZlc09mVHlwZSgnY2FyZC1ib2FyZC12aWV3Jyk7XHJcbiAgICBjb25zb2xlLmxvZygnVW5sb2FkaW5nIENhcmRCb2FyZCBQbHVnaW4nKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGxvYWRTZXR0aW5ncygpIHtcclxuICAgIHRoaXMuc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKHt9LCBERUZBVUxUX1NFVFRJTkdTLCBhd2FpdCB0aGlzLmxvYWREYXRhKCkpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgc2F2ZVNldHRpbmdzKCkge1xyXG4gICAgYXdhaXQgdGhpcy5zYXZlRGF0YSh0aGlzLnNldHRpbmdzKTtcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIENhcmRCb2FyZFZpZXcgZXh0ZW5kcyBJdGVtVmlldyB7XHJcbiAgcHJpdmF0ZSB2YXVsdDogVmF1bHQ7XHJcbiAgcHJpdmF0ZSBmb2xkZXJTdGFjazogVEZvbGRlcltdO1xyXG4gIHByaXZhdGUgcGx1Z2luOiBDYXJkQm9hcmRQbHVnaW47IC8vIEFkZCB0aGUgcGx1Z2luIHByb3BlcnR5XHJcblxyXG4gIGNvbnN0cnVjdG9yKGxlYWY6IFdvcmtzcGFjZUxlYWYsIHZhdWx0OiBWYXVsdCwgcGx1Z2luOiBDYXJkQm9hcmRQbHVnaW4pIHsgLy8gQWRkIHBsdWdpbiB0byBjb25zdHJ1Y3RvclxyXG4gICAgc3VwZXIobGVhZik7XHJcbiAgICB0aGlzLnZhdWx0ID0gdmF1bHQ7XHJcbiAgICB0aGlzLmZvbGRlclN0YWNrID0gW3RoaXMudmF1bHQuZ2V0Um9vdCgpXTtcclxuICAgIHRoaXMucGx1Z2luID0gcGx1Z2luOyAvLyBBc3NpZ24gdGhlIHBsdWdpbiBpbnN0YW5jZVxyXG4gIH1cclxuXHJcbiAgZ2V0Vmlld1R5cGUoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiAnY2FyZC1ib2FyZC12aWV3JztcclxuICB9XHJcblxyXG4gIGdldERpc3BsYXlUZXh0KCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gJ0NhcmQgQm9hcmQnO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgb25PcGVuKCkge1xyXG4gICAgYXdhaXQgdGhpcy5yZW5kZXJWaWV3KCk7XHJcbiAgfVxyXG5cclxuICBhc3luYyByZW5kZXJWaWV3KCkge1xyXG4gICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5jb250YWluZXJFbC5jaGlsZHJlblsxXSBhcyBIVE1MRWxlbWVudDtcclxuICAgIGNvbnRhaW5lci5lbXB0eSgpO1xyXG4gICAgY29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ2JvYXJkLWNvbnRhaW5lcicpO1xyXG5cclxuICAgIGF3YWl0IHRoaXMuY3JlYXRlRm9sZGVyVmlldyh0aGlzLmZvbGRlclN0YWNrW3RoaXMuZm9sZGVyU3RhY2subGVuZ3RoIC0gMV0sIGNvbnRhaW5lcik7XHJcbiAgfVxyXG5cclxuICBhc3luYyBjcmVhdGVGb2xkZXJWaWV3KGZvbGRlcjogVEZvbGRlciwgcGFyZW50OiBIVE1MRWxlbWVudCkge1xyXG4gICAgY29uc3QgZm9sZGVyQ29udGFpbmVyID0gcGFyZW50LmNyZWF0ZURpdih7IGNsczogJ2ZvbGRlci1jb250YWluZXInIH0pO1xyXG4gICAgY29uc3QgZm9sZGVySGVhZGVyID0gZm9sZGVyQ29udGFpbmVyLmNyZWF0ZURpdih7IGNsczogJ2ZvbGRlci1oZWFkZXInIH0pO1xyXG5cclxuICAgIGlmICh0aGlzLmZvbGRlclN0YWNrLmxlbmd0aCA+IDEpIHtcclxuICAgICAgY29uc3QgYmFja0J1dHRvbiA9IGZvbGRlckhlYWRlci5jcmVhdGVFbCgnYnV0dG9uJywgeyBjbHM6ICdiYWNrLWJ1dHRvbicsIHRleHQ6ICdcdTIxOTAnIH0pO1xyXG4gICAgICBiYWNrQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuZm9sZGVyU3RhY2sucG9wKCk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJWaWV3KCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGZvbGRlckhlYWRlci5jcmVhdGVTcGFuKHsgdGV4dDogZm9sZGVyLm5hbWUgfSk7XHJcblxyXG4gICAgY29uc3Qgbm90ZXNDb250YWluZXIgPSBmb2xkZXJDb250YWluZXIuY3JlYXRlRGl2KHsgY2xzOiAnbm90ZXMtY29udGFpbmVyJyB9KTtcclxuXHJcbiAgICBjb25zdCBmb2xkZXJzID0gZm9sZGVyLmNoaWxkcmVuLmZpbHRlcigoY2hpbGQpOiBjaGlsZCBpcyBURm9sZGVyID0+IGNoaWxkIGluc3RhbmNlb2YgVEZvbGRlcik7XHJcbiAgICBjb25zdCBub3RlcyA9IGZvbGRlci5jaGlsZHJlbi5maWx0ZXIoKGNoaWxkKTogY2hpbGQgaXMgVEZpbGUgPT4gY2hpbGQgaW5zdGFuY2VvZiBURmlsZSAmJiBjaGlsZC5leHRlbnNpb24gPT09ICdtZCcpO1xyXG5cclxuICAgIGZvciAoY29uc3QgZm9sZGVyIG9mIGZvbGRlcnMpIHtcclxuICAgICAgbm90ZXNDb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5jcmVhdGVGb2xkZXJDYXJkKGZvbGRlcikpO1xyXG4gICAgfVxyXG5cclxuICAgIGZvciAoY29uc3Qgbm90ZSBvZiBub3Rlcykge1xyXG4gICAgICBub3Rlc0NvbnRhaW5lci5hcHBlbmRDaGlsZChhd2FpdCB0aGlzLmNyZWF0ZUNhcmQobm90ZSkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY3JlYXRlRm9sZGVyQ2FyZChmb2xkZXI6IFRGb2xkZXIpOiBIVE1MRWxlbWVudCB7XHJcbiAgICBjb25zdCBjYXJkID0gY3JlYXRlRGl2KHsgY2xzOiBbJ2NhcmQnLCAnZm9sZGVyLWNhcmQnXSB9KTtcclxuICBcclxuICAgIC8vIERpc3BsYXkgZm9sZGVyIG5hbWUgZGlyZWN0bHk6XHJcbiAgICBjb25zdCB0aXRsZUNvbnRhaW5lciA9IGNhcmQuY3JlYXRlRGl2KHsgY2xzOiAnZm9sZGVyLXRpdGxlJyB9KTtcclxuICAgIHRpdGxlQ29udGFpbmVyLnRleHRDb250ZW50ID0gZm9sZGVyLm5hbWU7XHJcbiAgXHJcbiAgICBjYXJkLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICB0aGlzLmZvbGRlclN0YWNrLnB1c2goZm9sZGVyKTtcclxuICAgICAgdGhpcy5yZW5kZXJWaWV3KCk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiBjYXJkO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgY3JlYXRlQ2FyZChmaWxlOiBURmlsZSk6IFByb21pc2U8SFRNTEVsZW1lbnQ+IHtcclxuICAgIGNvbnN0IGNhcmQgPSBjcmVhdGVEaXYoeyBcclxuICAgICAgY2xzOiAnY2FyZCcsXHJcbiAgICAgIGF0dHI6IHtcclxuICAgICAgICBzdHlsZTogYHdpZHRoOiAke3RoaXMucGx1Z2luLnNldHRpbmdzLmNhcmRXaWR0aH1weDsgaGVpZ2h0OiAke3RoaXMucGx1Z2luLnNldHRpbmdzLmNhcmRIZWlnaHR9cHg7YCBcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gQWRkIGEgY29udGFpbmVyIGZvciB0aGUgbm90ZSB0aXRsZVxyXG4gICAgY29uc3QgdGl0bGVDb250YWluZXIgPSBjYXJkLmNyZWF0ZURpdih7IGNsczogJ2NhcmQtdGl0bGUnIH0pO1xyXG4gICAgdGl0bGVDb250YWluZXIudGV4dENvbnRlbnQgPSBmaWxlLmJhc2VuYW1lOyBcclxuXHJcbiAgICBjb25zdCB0aHVtYiA9IGF3YWl0IHRoaXMuZ2V0VGh1bWJuYWlsKGZpbGUpO1xyXG4gICAgaWYgKHRodW1iKSB7XHJcbiAgICAgIGNhcmQuYXBwZW5kQ2hpbGQodGh1bWIpOyAvLyBBcHBlbmQgdGhlIHRodW1ibmFpbCBlbGVtZW50IChpbWFnZSBvciB2aWRlbylcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNhcmQudGV4dENvbnRlbnQgPSBmaWxlLmJhc2VuYW1lO1xyXG4gICAgfVxyXG5cclxuICAgIGNhcmQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGZpbGVQYXRoID0gZmlsZS5wYXRoO1xyXG4gIFxyXG4gICAgICBpZiAodGhpcy5wbHVnaW4uc2V0dGluZ3Mub3Blbk5vdGVJbk5ld1RhYikge1xyXG4gICAgICAgIHRoaXMuYXBwLndvcmtzcGFjZS5vcGVuTGlua1RleHQoZmlsZVBhdGgsICcnLCB0cnVlLCB7IGFjdGl2ZTogdHJ1ZSB9KTsgLy8gTmV3IHRhYlxyXG4gICAgICB9IGVsc2UgeyAgXHJcbiAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLm9wZW5MaW5rVGV4dChmaWxlUGF0aCwgJycsIGZhbHNlKTsgLy8gU2FtZSB0YWIgKGNoYW5nZWQgdG8gZmFsc2UpXHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IGNvbmZpZ0J1dHRvbiA9IGNhcmQuY3JlYXRlRWwoJ2J1dHRvbicsIHsgY2xzOiAnY29uZmlnLWJ1dHRvbicsIHRleHQ6ICdcdTI2OTknIH0pO1xyXG4gICAgY29uZmlnQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcclxuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgbmV3IE5vdGVDb25maWdNb2RhbCh0aGlzLmFwcCwgZmlsZSwgdGhpcykub3BlbigpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGNhcmQ7XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRUaHVtYm5haWwoZmlsZTogVEZpbGUpOiBQcm9taXNlPEhUTUxFbGVtZW50IHwgbnVsbD4ge1xyXG4gICAgY29uc3QgY29udGVudCA9IGF3YWl0IHRoaXMudmF1bHQuY2FjaGVkUmVhZChmaWxlKTtcclxuICBcclxuICAgIC8vIFVwZGF0ZWQgcmVnZXggdG8gaW5jbHVkZSB2aWRlbyBleHRlbnNpb25zOlxyXG4gICAgY29uc3QgaW1hZ2VSZWdleCA9IC8hXFxbXFxbKC4qPylcXF1cXF18IVxcWyguKj8pXFxdXFwoKFteKV0qKVxcKS9nO1xyXG4gICAgbGV0IG1hdGNoO1xyXG4gICAgd2hpbGUgKChtYXRjaCA9IGltYWdlUmVnZXguZXhlYyhjb250ZW50KSkgIT09IG51bGwpIHtcclxuICAgICAgbGV0IGZpbGVQYXRoID0gbWF0Y2hbMV0gfHwgbWF0Y2hbM107XHJcbiAgXHJcbiAgICAgIGlmIChmaWxlUGF0aC5zdGFydHNXaXRoKCdmaWxlOi8vLycpKSB7XHJcbiAgICAgICAgZmlsZVBhdGggPSBkZWNvZGVVUkkoZmlsZVBhdGgpXHJcbiAgICAgICAgICAucmVwbGFjZSgvXmZpbGU6XFwvezIsM30vLCAnJylcclxuICAgICAgICAgIC5yZXBsYWNlKC9cXFxcL2csICcvJyk7XHJcbiAgICAgIH1cclxuICBcclxuICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhbiBpbWFnZSBvciB2aWRlbzpcclxuICAgICAgaWYgKC9cXC4oanBnfGpwZWd8cG5nfGdpZnxibXB8bXA0fHdlYm0pJC9pLnRlc3QoZmlsZVBhdGgpKSB7IFxyXG4gICAgICAgIGNvbnN0IGZpbGVMaW5rID0gdGhpcy5hcHAubWV0YWRhdGFDYWNoZS5nZXRGaXJzdExpbmtwYXRoRGVzdChmaWxlUGF0aCwgZmlsZS5wYXRoKTtcclxuICAgICAgICBpZiAoZmlsZUxpbmspIHtcclxuICAgICAgICAgIGNvbnN0IHJlc291cmNlUGF0aCA9IHRoaXMudmF1bHQuYWRhcHRlci5nZXRSZXNvdXJjZVBhdGgoZmlsZUxpbmsucGF0aCk7XHJcbiAgXHJcbiAgICAgICAgICAvLyBDcmVhdGUgYW4gaW1hZ2Ugb3IgdmlkZW8gZWxlbWVudDpcclxuICAgICAgICAgIGlmICgvXFwuKGpwZ3xqcGVnfHBuZ3xnaWZ8Ym1wKSQvaS50ZXN0KGZpbGVQYXRoKSkge1xyXG4gICAgICAgICAgICBjb25zdCBpbWcgPSBjcmVhdGVFbChcImltZ1wiKTtcclxuICAgICAgICAgICAgaW1nLnNyYyA9IHJlc291cmNlUGF0aDtcclxuICAgICAgICAgICAgcmV0dXJuIGltZztcclxuICAgICAgICAgIH0gZWxzZSB7IC8vIFZpZGVvXHJcbiAgICAgICAgICAgIGNvbnN0IHZpZGVvID0gY3JlYXRlRWwoXCJ2aWRlb1wiKTtcclxuICAgICAgICAgICAgdmlkZW8uc3JjID0gcmVzb3VyY2VQYXRoO1xyXG4gICAgICAgICAgICB2aWRlby5jb250cm9scyA9IHRydWU7IC8vIEFkZCB2aWRlbyBjb250cm9scyBcclxuICAgICAgICAgICAgdmlkZW8ubXV0ZWQgPSB0cnVlOyAgICAgLy8gTXV0ZSBieSBkZWZhdWx0XHJcbiAgICAgICAgICAgIHZpZGVvLnN0eWxlLndpZHRoID0gXCIxMDAlXCI7XHJcbiAgICAgICAgICAgIHZpZGVvLnN0eWxlLmhlaWdodCA9IFwiYXV0b1wiO1xyXG4gICAgICAgICAgICByZXR1cm4gdmlkZW87XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbnVsbDtcclxuICB9XHJcblxyXG4gIGFzeW5jIG9uQ2xvc2UoKSB7XHJcbiAgICAvLyBDbGVhbiB1cCBpZiBuZWVkZWRcclxuICB9XHJcbn1cclxuXHJcbmNsYXNzIE5vdGVDb25maWdNb2RhbCBleHRlbmRzIE1vZGFsIHtcclxuICAgIHByaXZhdGUgZmlsZTogVEZpbGU7XHJcbiAgICBwcml2YXRlIGltYWdlUGF0aHM6IHN0cmluZ1tdO1xyXG4gICAgcHJpdmF0ZSBjdXJyZW50SW1hZ2VJbmRleDogbnVtYmVyO1xyXG4gICAgcHJpdmF0ZSBjYXJkQm9hcmRWaWV3OiBDYXJkQm9hcmRWaWV3O1xyXG4gIFxyXG4gICAgY29uc3RydWN0b3IoYXBwOiBBcHAsIGZpbGU6IFRGaWxlLCBjYXJkQm9hcmRWaWV3OiBDYXJkQm9hcmRWaWV3KSB7XHJcbiAgICAgIHN1cGVyKGFwcCk7XHJcbiAgICAgIHRoaXMuZmlsZSA9IGZpbGU7XHJcbiAgICAgIHRoaXMuaW1hZ2VQYXRocyA9IFtdO1xyXG4gICAgICB0aGlzLmN1cnJlbnRJbWFnZUluZGV4ID0gMDtcclxuICAgICAgdGhpcy5jYXJkQm9hcmRWaWV3ID0gY2FyZEJvYXJkVmlldztcclxuICAgIH1cclxuICBcclxuICAgIGFzeW5jIG9uT3BlbigpIHtcclxuICAgICAgYXdhaXQgdGhpcy5sb2FkSW1hZ2VzKCk7XHJcbiAgICAgIHRoaXMuZGlzcGxheUltYWdlKCk7XHJcbiAgICB9XHJcbiAgXHJcbiAgICBhc3luYyBsb2FkSW1hZ2VzKCkge1xyXG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBhd2FpdCB0aGlzLmFwcC52YXVsdC5jYWNoZWRSZWFkKHRoaXMuZmlsZSk7XHJcbiAgICAgICAgY29uc3QgaW1hZ2VSZWdleCA9IC8hXFxbXFxbKC4qPylcXF1cXF18IVxcWyguKj8pXFxdXFwoKFteKV0qKVxcKS9nO1xyXG4gICAgICAgIGxldCBtYXRjaDtcclxuICAgICAgICB3aGlsZSAoKG1hdGNoID0gaW1hZ2VSZWdleC5leGVjKGNvbnRlbnQpKSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgbGV0IGltYWdlUGF0aCA9IG1hdGNoWzFdIHx8IG1hdGNoWzNdO1xyXG4gICAgICBcclxuICAgICAgICAgIC8vIFNwZWNpZmljIGNoZWNrIGZvciBmaWxlIFVSTHM6XHJcbiAgICAgICAgICBpZiAoaW1hZ2VQYXRoLnN0YXJ0c1dpdGgoJ2ZpbGU6Ly8vJykpIHtcclxuICAgICAgICAgICAgaW1hZ2VQYXRoID0gZGVjb2RlVVJJKGltYWdlUGF0aClcclxuICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKC9eZmlsZTpcXC97MiwzfS8sICcnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2UoL1xcXFwvZywgJy8nKTsgLy8gUmVwbGFjZSBiYWNrc2xhc2hlc1xyXG4gICAgICAgICAgfVxyXG4gICAgICBcclxuICAgICAgICAgIGlmIChpbWFnZVBhdGggJiYgL1xcLihqcGd8anBlZ3xwbmd8Z2lmfGJtcCkkLy50ZXN0KGltYWdlUGF0aCkpIHtcclxuICAgICAgICAgICAgdGhpcy5pbWFnZVBhdGhzLnB1c2goaW1hZ2VQYXRoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICBkaXNwbGF5SW1hZ2UoKSB7XHJcbiAgICAgICAgdGhpcy5jb250ZW50RWwuZW1wdHkoKTtcclxuICAgIFxyXG4gICAgICAgIGlmICh0aGlzLmltYWdlUGF0aHMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgY29uc3QgaW1hZ2VQYXRoID0gdGhpcy5pbWFnZVBhdGhzW3RoaXMuY3VycmVudEltYWdlSW5kZXhdO1xyXG4gICAgICAgICAgY29uc3QgZmlsZUxpbmsgPSB0aGlzLmFwcC5tZXRhZGF0YUNhY2hlLmdldEZpcnN0TGlua3BhdGhEZXN0KGltYWdlUGF0aCwgdGhpcy5maWxlLnBhdGgpO1xyXG4gICAgXHJcbiAgICAgICAgICBpZiAoZmlsZUxpbmspIHtcclxuICAgICAgICAgICAgY29uc3QgaW1nU3JjID0gdGhpcy5hcHAudmF1bHQuYWRhcHRlci5nZXRSZXNvdXJjZVBhdGgoZmlsZUxpbmsucGF0aCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBDcmVhdGUgYSBjb250YWluZXIgZm9yIHRoZSBpbWFnZSB0byBjb250cm9sIGl0cyBzaXplXHJcbiAgICAgICAgICAgIGNvbnN0IGltZ0NvbnRhaW5lciA9IHRoaXMuY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogJ2ltYWdlLWNvbnRhaW5lcicgfSk7IFxyXG4gICAgICAgICAgICBjb25zdCBpbWcgPSBpbWdDb250YWluZXIuY3JlYXRlRWwoJ2ltZycsIHsgYXR0cjogeyBzcmM6IGltZ1NyYyB9IH0pO1xyXG5cclxuICAgICAgICAgICAgLy8gQnV0dG9ucyBDb250YWluZXJcclxuICAgICAgICAgICAgY29uc3QgYnV0dG9uc0NvbnRhaW5lciA9IHRoaXMuY29udGVudEVsLmNyZWF0ZURpdih7IGNsczogJ2J1dHRvbnMtY29udGFpbmVyJyB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAvLyBQcmV2aW91cyBCdXR0b25cclxuICAgICAgICAgICAgY29uc3QgcHJldkJ1dHRvbiA9IGJ1dHRvbnNDb250YWluZXIuY3JlYXRlRWwoJ2J1dHRvbicsIHsgY2xzOiAnbmF2LWJ1dHRvbiBwcmV2LWJ1dHRvbicsIHRleHQ6ICdcdTIwMzknIH0pOyAvLyBVc2UgYXJyb3cgaWNvblxyXG4gICAgICAgICAgICBwcmV2QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMuY3VycmVudEltYWdlSW5kZXggPSAodGhpcy5jdXJyZW50SW1hZ2VJbmRleCAtIDEgKyB0aGlzLmltYWdlUGF0aHMubGVuZ3RoKSAlIHRoaXMuaW1hZ2VQYXRocy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgdGhpcy5kaXNwbGF5SW1hZ2UoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICAgICAgLy8gTmV4dCBCdXR0b25cclxuICAgICAgICAgICAgY29uc3QgbmV4dEJ1dHRvbiA9IGJ1dHRvbnNDb250YWluZXIuY3JlYXRlRWwoJ2J1dHRvbicsIHsgY2xzOiAnbmF2LWJ1dHRvbiBuZXh0LWJ1dHRvbicsIHRleHQ6ICdcdTIwM0EnIH0pOyAvLyBVc2UgYXJyb3cgaWNvblxyXG4gICAgICAgICAgICBuZXh0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAgIHRoaXMuY3VycmVudEltYWdlSW5kZXggPSAodGhpcy5jdXJyZW50SW1hZ2VJbmRleCArIDEpICUgdGhpcy5pbWFnZVBhdGhzLmxlbmd0aDtcclxuICAgICAgICAgICAgICB0aGlzLmRpc3BsYXlJbWFnZSgpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgIFxyXG4gICAgICAgICAgICAvLyBTZXQgVGh1bWJuYWlsIEJ1dHRvbiBcclxuICAgICAgICAgICAgY29uc3Qgc2V0VGh1bWJuYWlsQnV0dG9uID0gdGhpcy5jb250ZW50RWwuY3JlYXRlRWwoJ2J1dHRvbicsIHsgXHJcbiAgICAgICAgICAgICAgICBjbHM6ICdzZXQtYnV0dG9uJywgXHJcbiAgICAgICAgICAgICAgICB0ZXh0OiAnU2V0IGFzIFRodW1ibmFpbCcgXHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgc2V0VGh1bWJuYWlsQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgIGF3YWl0IHRoaXMuc2V0VGh1bWJuYWlsKHRoaXMuaW1hZ2VQYXRoc1t0aGlzLmN1cnJlbnRJbWFnZUluZGV4XSk7IFxyXG4gICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTsgLy8gQ2xvc2UgdGhlIG1vZGFsIGFmdGVyIHNldHRpbmdcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMuY29udGVudEVsLnNldFRleHQoJ05vIGltYWdlcyBmb3VuZCBpbiB0aGlzIG5vdGUuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICBhc3luYyBzZXRUaHVtYm5haWwoaW1hZ2VQYXRoOiBzdHJpbmcpIHtcclxuICAgICAgICBsZXQgbmV3Q29udGVudCA9IGF3YWl0IHRoaXMuYXBwLnZhdWx0LnJlYWQodGhpcy5maWxlKTtcclxuICAgIFxyXG4gICAgICAgIC8vIDEuIFJlbW92ZSB0aGUgc2VsZWN0ZWQgaW1hZ2UgbGluayBmcm9tIHRoZSBjb250ZW50XHJcbiAgICAgICAgY29uc3QgaW1hZ2VSZWdleCA9IG5ldyBSZWdFeHAoYCFcXFxcW1xcXFxbJHtpbWFnZVBhdGh9XFxcXF1cXFxcXXwhXFxcXFsuKj9cXFxcXVxcXFwoJHtpbWFnZVBhdGh9XFxcXClgLCAnZycpO1xyXG4gICAgICAgIG5ld0NvbnRlbnQgPSBuZXdDb250ZW50LnJlcGxhY2UoaW1hZ2VSZWdleCwgJycpO1xyXG4gICAgXHJcbiAgICAgICAgLy8gMi4gQWRkIHRoZSBzZWxlY3RlZCBpbWFnZSBsaW5rIHRvIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGNvbnRlbnRcclxuICAgICAgICAvLyAgICBVc2UgdGhlIGNvcnJlY3QgZm9ybWF0IGJhc2VkIG9uIHdoZXRoZXIgaXQncyBhIGZpbGUgVVJMIG9yIG5vdDpcclxuICAgICAgICBpZiAoaW1hZ2VQYXRoLnN0YXJ0c1dpdGgoJ2ZpbGU6Ly8vJykpIHtcclxuICAgICAgICAgIG5ld0NvbnRlbnQgPSBgIVsgXSgke2ltYWdlUGF0aH0pXFxuXFxuJHtuZXdDb250ZW50fWA7ICAvLyBNYXJrZG93biBsaW5rIGZvciBmaWxlIFVSTFxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBuZXdDb250ZW50ID0gYCFbWyR7aW1hZ2VQYXRofV1dXFxuXFxuJHtuZXdDb250ZW50fWA7ICAvLyBXaWtpbGluayBmb3IgcmVndWxhciBwYXRoc1xyXG4gICAgICAgIH1cclxuICAgIFxyXG4gICAgICAgIC8vIDMuIFdyaXRlIHRoZSB1cGRhdGVkIGNvbnRlbnQgYmFjayB0byB0aGUgZmlsZVxyXG4gICAgICAgIGF3YWl0IHRoaXMuYXBwLnZhdWx0Lm1vZGlmeSh0aGlzLmZpbGUsIG5ld0NvbnRlbnQpO1xyXG4gICAgXHJcbiAgICAgICAgLy8gNC4gUmVmcmVzaCBDYXJkQm9hcmRWaWV3XHJcbiAgICAgICAgdGhpcy5jYXJkQm9hcmRWaWV3LnJlbmRlclZpZXcoKTtcclxuICAgICAgICB0aGlzLmNsb3NlKCk7IC8vIENsb3NlIHRoZSBtb2RhbFxyXG4gICAgICB9XHJcblxyXG4gIG9uQ2xvc2UoKSB7XHJcbiAgICB0aGlzLmNvbnRlbnRFbC5lbXB0eSgpO1xyXG4gIH1cclxufSIsICJpbXBvcnQgeyBQbHVnaW5TZXR0aW5nVGFiLCBBcHAsIFNldHRpbmcgfSBmcm9tIFwib2JzaWRpYW5cIjtcclxuaW1wb3J0IENhcmRCb2FyZFBsdWdpbiBmcm9tIFwiLi9tYWluXCI7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIENhcmRCb2FyZFBsdWdpblNldHRpbmdzIHtcclxuICAgIG9wZW5Ob3RlSW5OZXdUYWI6IGJvb2xlYW47XHJcbiAgICBjYXJkV2lkdGg6IG51bWJlcjsgIC8vIEFkZCBiYWNrIGNhcmRXaWR0aFxyXG4gICAgY2FyZEhlaWdodDogbnVtYmVyOyAvLyBBZGQgYmFjayBjYXJkSGVpZ2h0XHJcbiAgfVxyXG5cclxuICBleHBvcnQgY29uc3QgREVGQVVMVF9TRVRUSU5HUzogQ2FyZEJvYXJkUGx1Z2luU2V0dGluZ3MgPSB7XHJcbiAgICBvcGVuTm90ZUluTmV3VGFiOiBmYWxzZSxcclxuICAgIGNhcmRXaWR0aDogMjAwLCAgLy8gRGVmYXVsdCBjYXJkIHdpZHRoXHJcbiAgICBjYXJkSGVpZ2h0OiAyMDAsIC8vIERlZmF1bHQgY2FyZCBoZWlnaHRcclxuICB9O1xyXG5cclxuZXhwb3J0IGNsYXNzIENhcmRCb2FyZFNldHRpbmdUYWIgZXh0ZW5kcyBQbHVnaW5TZXR0aW5nVGFiIHtcclxuICBwbHVnaW46IENhcmRCb2FyZFBsdWdpbjtcclxuXHJcbiAgY29uc3RydWN0b3IoYXBwOiBBcHAsIHBsdWdpbjogQ2FyZEJvYXJkUGx1Z2luKSB7XHJcbiAgICBzdXBlcihhcHAsIHBsdWdpbik7XHJcbiAgICB0aGlzLnBsdWdpbiA9IHBsdWdpbjtcclxuICB9XHJcblxyXG4gIGRpc3BsYXkoKTogdm9pZCB7XHJcbiAgICBjb25zdCB7IGNvbnRhaW5lckVsIH0gPSB0aGlzO1xyXG4gICAgY29udGFpbmVyRWwuZW1wdHkoKTtcclxuXHJcbiAgICBjb250YWluZXJFbC5jcmVhdGVFbChcImgyXCIsIHsgdGV4dDogXCJDYXJkQm9hcmQgUGx1Z2luIFNldHRpbmdzXCIgfSk7XHJcblxyXG4gICAgbmV3IFNldHRpbmcoY29udGFpbmVyRWwpXHJcbiAgICAgIC5zZXROYW1lKFwiT3BlbiBOb3RlIGluIE5ldyBUYWJcIilcclxuICAgICAgLnNldERlc2MoXCJPcGVuIG5vdGVzIGluIGEgbmV3IHRhYiB3aGVuIGNsaWNrZWRcIilcclxuICAgICAgLmFkZFRvZ2dsZSgodG9nZ2xlKSA9PlxyXG4gICAgICAgIHRvZ2dsZVxyXG4gICAgICAgICAgLnNldFZhbHVlKHRoaXMucGx1Z2luLnNldHRpbmdzLm9wZW5Ob3RlSW5OZXdUYWIpXHJcbiAgICAgICAgICAub25DaGFuZ2UoYXN5bmMgKHZhbHVlKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMucGx1Z2luLnNldHRpbmdzLm9wZW5Ob3RlSW5OZXdUYWIgPSB2YWx1ZTtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5wbHVnaW4uc2F2ZVNldHRpbmdzKCk7XHJcbiAgICAgICAgICAgIC8vIE5vIG5lZWQgdG8gcmVmcmVzaCB0aGUgdmlldyBoZXJlXHJcbiAgICAgICAgICB9KVxyXG4gICAgICApOyBcclxuICB9XHJcbn0iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFB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QVUsVUFBVSxFQUFFLEtBQUssb0JBQW9CLENBQUM7QUFHOUUsY0FBTSxhQUFhLGlCQUFpQixTQUFTLFVBQVUsRUFBRSxLQUFLLDBCQUEwQixNQUFNLFNBQUksQ0FBQztBQUNuRyxtQkFBVyxpQkFBaUIsU0FBUyxNQUFNO0FBQ3pDLGVBQUsscUJBQXFCLEtBQUssb0JBQW9CLElBQUksS0FBSyxXQUFXLFVBQVUsS0FBSyxXQUFXO0FBQ2pHLGVBQUssYUFBYTtBQUFBLFFBQ3BCLENBQUM7QUFHRCxjQUFNLGFBQWEsaUJBQWlCLFNBQVMsVUFBVSxFQUFFLEtBQUssMEJBQTBCLE1BQU0sU0FBSSxDQUFDO0FBQ25HLG1CQUFXLGlCQUFpQixTQUFTLE1BQU07QUFDekMsZUFBSyxxQkFBcUIsS0FBSyxvQkFBb0IsS0FBSyxLQUFLLFdBQVc7QUFDeEUsZUFBSyxhQUFhO0FBQUEsUUFDcEIsQ0FBQztBQUdELGNBQU0scUJBQXFCLEtBQUssVUFBVSxTQUFTLFVBQVU7QUFBQSxVQUN6RCxLQUFLO0FBQUEsVUFDTCxNQUFNO0FBQUEsUUFDUixDQUFDO0FBQ0QsMkJBQW1CLGlCQUFpQixTQUFTLFlBQVk7QUFDekQsZ0JBQU0sS0FBSyxhQUFhLEtBQUssV0FBVyxLQUFLLGlCQUFpQixDQUFDO0FBQy9ELGVBQUssTUFBTTtBQUFBLFFBQ2IsQ0FBQztBQUFBLE1BQ0g7QUFBQSxJQUNGLE9BQU87QUFDTCxXQUFLLFVBQVUsUUFBUSwrQkFBK0I7QUFBQSxJQUN4RDtBQUFBLEVBQ0Y7QUFBQSxFQUVBLE1BQU0sYUFBYSxXQUFtQjtBQUNwQyxRQUFJLGFBQWEsTUFBTSxLQUFLLElBQUksTUFBTSxLQUFLLEtBQUssSUFBSTtBQUdwRCxVQUFNLGFBQWEsSUFBSSxPQUFPLFVBQVUsZ0NBQWdDLGdCQUFnQixHQUFHO0FBQzNGLGlCQUFhLFdBQVcsUUFBUSxZQUFZLEVBQUU7QUFJOUMsUUFBSSxVQUFVLFdBQVcsVUFBVSxHQUFHO0FBQ3BDLG1CQUFhLFFBQVE7QUFBQTtBQUFBLEVBQWlCO0FBQUEsSUFDeEMsT0FBTztBQUNMLG1CQUFhLE1BQU07QUFBQTtBQUFBLEVBQWtCO0FBQUEsSUFDdkM7QUFHQSxVQUFNLEtBQUssSUFBSSxNQUFNLE9BQU8sS0FBSyxNQUFNLFVBQVU7QUFHakQsU0FBSyxjQUFjLFdBQVc7QUFDOUIsU0FBSyxNQUFNO0FBQUEsRUFDYjtBQUFBLEVBRUosVUFBVTtBQUNSLFNBQUssVUFBVSxNQUFNO0FBQUEsRUFDdkI7QUFDRjsiLAogICJuYW1lcyI6IFsiaW1wb3J0X29ic2lkaWFuIiwgImZvbGRlciJdCn0K
